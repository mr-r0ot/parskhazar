<!doctype html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>فروشگاه آنلاین — پارس خزر شعبه طوبی | محصولات</title>
  <meta name="description" content="فروش آنلاین محصولات پارس خزر — جستجو، فیلتر، مرتب‌سازی و سبد خرید." />
  <link rel="icon" href="photo1.jpg">
  <style>
    /* ---------- Variables ---------- */
    :root{--accent1:#ff2d95;--accent2:#6f3cff;--bg-light:#fff;--text-light:#111;--muted-light:#6b6172;--bg-dark:#0b0710;--text-dark:#efe9f6;--muted-dark:#bdb3c9;--max-width:1200px}

    /* ---------- Reset ---------- */
    *{box-sizing:border-box;margin:0;padding:0}
    html,body{height:100%}
    body{font-family: -apple-system,BlinkMacSystemFont,"Segoe UI","Helvetica Neue",Arial,"Noto Sans","IRANSans",sans-serif;line-height:1.45;background:var(--bg-light);color:var(--text-light);transition:background .22s,color .22s;direction:rtl;padding:18px}
    a{color:inherit;text-decoration:none}

    /* ---------- Layout container ---------- */
    .wrap{max-width:var(--max-width);margin:0 auto}

    /* ---------- Header (sticky) ---------- */
    header{display:flex;align-items:center;gap:14px;justify-content:space-between;margin-bottom:18px;position:sticky;top:12px;background:rgba(255,255,255,0.92);backdrop-filter:blur(6px);padding:10px;border-radius:12px;z-index:30}
    body.dark header{background:rgba(11,7,16,0.82)}

    .brand{display:flex;gap:12px;align-items:center}
    .brand img{width:68px;height:68px;border-radius:12px;object-fit:cover;box-shadow:0 10px 40px rgba(111,60,255,0.08)}
    .brand h1{font-size:17px}
    .brand p{margin:0;font-size:12px;color:var(--muted-light)}
    body.dark .brand p{color:var(--muted-dark)}

    /* controls */
    .controls{display:flex;gap:10px;align-items:center}
    .search{display:flex;align-items:center;gap:8px;background:rgba(0,0,0,0.04);padding:8px;border-radius:12px}
    .search input{border:0;background:transparent;padding:6px 8px;outline:none;width:260px}
    .select, .input-small{padding:8px;border-radius:10px;border:1px solid rgba(0,0,0,0.06);background:transparent}

    /* cart fixed (kept inside viewport and responsive) */
    .cart-fixed{position:fixed;top:18px;right:18px;z-index:80}
    .cart-btn{display:inline-flex;align-items:center;gap:8px;padding:10px 14px;border-radius:12px;background:linear-gradient(90deg,var(--accent2),var(--accent1));color:#fff;font-weight:800;box-shadow:0 18px 60px rgba(111,60,255,0.12)}
    .cart-count{position:absolute;top:-8px;left:-8px;background:var(--accent1);color:#fff;width:22px;height:22px;border-radius:999px;display:flex;align-items:center;justify-content:center;font-size:12px;font-weight:800;box-shadow:0 8px 30px rgba(111,60,255,0.12)}

    /* layout */
    .content{display:grid;grid-template-columns:280px 1fr;gap:18px;margin-top:12px}
    @media (max-width:980px){ .content{grid-template-columns:1fr} .search input{width:140px} }

    aside.filters{background:rgba(0,0,0,0.03);padding:14px;border-radius:12px}
    aside h3{margin:0 0 8px 0}
    .filter-row{display:flex;flex-direction:column;gap:8px;margin-bottom:10px}
    .range{display:flex;gap:8px}
    .range input{flex:1}

    .products-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:14px}
    @media (max-width:980px){.products-grid{grid-template-columns:repeat(2,1fr)}}
    @media (max-width:560px){.products-grid{grid-template-columns:1fr}}

    .card{background:linear-gradient(180deg,rgba(0,0,0,0.02),transparent);padding:12px;border-radius:12px;border:1px solid rgba(0,0,0,0.04);display:flex;flex-direction:column;gap:10px;height:100%;min-height:280px}
    .card .media{height:180px;border-radius:10px;overflow:hidden;background:linear-gradient(135deg,var(--accent1),var(--accent2));display:flex;align-items:center;justify-content:center}
    .card img{width:100%;height:100%;object-fit:cover;display:block}
    .card .title{font-weight:800;font-size:15px}
    .meta{color:var(--muted-light);font-size:13px}
    body.dark .meta{color:var(--muted-dark)}
    .price{font-weight:900;color:var(--accent2)}
    .prod-actions{display:flex;gap:8px;align-items:center;margin-top:auto}
    .btn{padding:8px 12px;border-radius:10px;border:0;cursor:pointer}
    .btn-add{background:linear-gradient(90deg,var(--accent1),var(--accent2));color:#fff;font-weight:800}
    .btn-view{background:transparent;border:1px solid rgba(0,0,0,0.06)}

    /* modal: constrained and scrollable to avoid overflow */
    .modal-backdrop{position:fixed;inset:0;background:rgba(0,0,0,0.55);display:none;align-items:center;justify-content:center;padding:20px;z-index:90}
    .modal{background:#fff;color:#111;max-width:920px;width:100%;border-radius:12px;padding:18px;box-shadow:0 24px 80px rgba(0,0,0,0.6);max-height:calc(100vh - 80px);overflow:auto}
    body.dark .modal{background:#0f0b14;color:var(--text-dark)}
    .modal-grid{display:grid;grid-template-columns:1fr 360px;gap:14px}
    .modal img{width:100%;height:340px;object-fit:contain;border-radius:8px}

    /* empty state */
    .empty{padding:40px;text-align:center;color:var(--muted-light);border-radius:12px}

    /* small responsive touches */
    @media (max-width:420px){ header{padding:8px} .search input{width:100px} .brand img{width:56px;height:56px} .modal-grid{grid-template-columns:1fr} .modal img{height:220px} }

    /* dark theme classes */
    body.dark{background:var(--bg-dark);color:var(--text-dark)}
    body.dark .card{background:linear-gradient(180deg,rgba(255,255,255,0.02),transparent);border:1px solid rgba(255,255,255,0.03)}

    /* nice transitions */
    .card, .btn, .select, input{transition:all .18s ease}

    /* collapsible filters on mobile */
    .filters-toggle{display:none}
    @media (max-width:980px){ .filters{display:none} .filters-toggle{display:block;margin-bottom:10px} }

  </style>
</head>
<body>
  <div class="wrap">
    <!-- CART fixed (moved to right so it stays in viewport) -->
    <div class="cart-fixed" role="button" aria-label="رفتن به سبد خرید">
      <a id="cartLink" href="cart.html" class="cart-btn">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M6 6h15l-1.5 9h-11z" fill="rgba(255,255,255,0.12)"/><path d="M9 20a1 1 0 1 0 0 2 1 1 0 0 0 0-2zm8 0a1 1 0 1 0 0 2 1 1 0 0 0 0-2z" fill="#fff"/></svg>
        <span>سبد خرید</span>
      </a>
      <div id="cartCount" class="cart-count" aria-live="polite">0</div>
    </div>

    <header>
      <div class="brand">
        <a href="index.html"><img src="photo1.jpg" alt="پارس خزر شعبه طوبی"></a>
        <div>
          <h1>فروشگاه آنلاین پارس خزر — شعبه طوبی</h1>
          <p>جستجو، فیلتر و خرید آسان</p>
        </div>
      </div>

      <div class="controls">
        <div class="search">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M21 21l-4.35-4.35" stroke="#666" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>
          <input id="searchInput" placeholder="جستجو در بین محصولات..." aria-label="جستجو در محصولات">
        </div>

        <select id="sortSelect" class="select" title="مرتب‌سازی">
          <option value="relevance">مرتب‌سازی: مرتبط‌ترین</option>
          <option value="price-asc">قیمت: کم → زیاد</option>
          <option value="price-desc">قیمت: زیاد → کم</option>
          <option value="name-asc">نام: A → Z</option>
          <option value="name-desc">نام: Z → A</option>
        </select>

        <button id="themeToggle" class="select" title="تغییر تم">تم: <span id="themeLabel">سفید</span></button>
      </div>
    </header>

    <div class="filters-toggle">
      <button id="showFilters" class="btn">نمایش فیلترها</button>
    </div>

    <div class="content">
      <aside class="filters" id="filtersPane" aria-hidden="false">
        <h3>فیلترها</h3>

        <div class="filter-row">
          <label class="meta">دسته‌بندی</label>
          <select id="typeFilter" class="select"><option value="all">همه</option></select>
        </div>

        <div class="filter-row">
          <label class="meta">قیمت (تومان)</label>
          <div class="range">
            <input id="minPrice" class="input-small" type="number" placeholder="حداقل" min="0">
            <input id="maxPrice" class="input-small" type="number" placeholder="حداکثر" min="0">
          </div>
        </div>

        <div class="filter-row">
          <label class="meta">تا قیمت (کشویی)</label>
          <input id="priceRange" type="range" min="0" max="10000000" step="1000" value="10000000" />
        </div>

        <div class="filter-row">
          <label class="meta">وضعیت</label>
          <select id="stockFilter" class="select"><option value="all">همه</option><option value="in">موجود</option><option value="out">ناموجود</option></select>
        </div>

        <div class="filter-row">
          <button id="resetFilters" class="btn">پاک کردن فیلترها</button>
        </div>
      </aside>

      <main>
        <div id="productsArea">
          <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:10px">
            <div class="meta">نمایش <strong id="productsCount">0</strong> محصول</div>
            <div style="display:flex;gap:8px;align-items:center">
              <button id="clearSearch" class="btn">پاک کردن جستجو</button>
            </div>
          </div>

          <div id="productsGrid" class="products-grid" aria-live="polite"></div>
          <div id="emptyState" class="empty" style="display:none">محصولی یافت نشد — فیلترها را بررسی کنید.</div>
        </div>
      </main>
    </div>

    <footer style="margin-top:18px;color:var(--muted-light)">© پارس خزر — شعبه طوبی · فروشگاه آنلاین</footer>
  </div>

  <!-- modal -->
  <div id="modalBackdrop" class="modal-backdrop" role="dialog" aria-hidden="true">
    <div class="modal" role="document">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
        <h3 id="modalTitle">جزئیات محصول</h3>
        <button id="modalClose" class="btn">بستن ✕</button>
      </div>
      <div class="modal-grid">
        <div>
          <img id="modalImg" src="" alt="تصویر محصول">
        </div>
        <div>
          <div class="meta" id="modalType"></div>
          <h2 id="modalName"></h2>
          <div style="margin:8px 0" class="price" id="modalPrice"></div>
          <p id="modalDesc" style="color:var(--muted-light)"></p>

          <div style="margin-top:18px;display:flex;gap:8px;align-items:center">
            <input id="modalQty" type="number" value="1" min="1" style="width:84px;padding:8px;border-radius:8px;border:1px solid rgba(0,0,0,0.06)">
            <button id="modalAdd" class="btn btn-add">افزودن به سبد</button>
          </div>

          <div id="modalMetaList" style="margin-top:12px;color:var(--muted-light)"></div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // ---------- Config & State ----------
    const PRODUCTS_JSON = 'shop.json';
    let allProducts = [];
    let filtered = [];

    const $ = s => document.querySelector(s);

    // ---------- Cart (localStorage) ----------
    function readCart(){ try{ return JSON.parse(localStorage.getItem('pk_cart')||'[]') }catch(e){return []} }
    function writeCart(cart){ localStorage.setItem('pk_cart', JSON.stringify(cart)); updateCartCount(); }
    function addToCart(productId, qty=1){ const cart = readCart(); const item = cart.find(i=>String(i.id)===String(productId)); if(item){ item.qty += qty } else { cart.push({id:productId, qty}) } writeCart(cart); }
    function cartTotalCount(){ return readCart().reduce((s,i)=>s+i.qty,0); }
    function updateCartCount(){ $('#cartCount').textContent = cartTotalCount(); }

    // ---------- Render ----------
    function formatPrice(n){ return Number(n).toLocaleString('fa-IR'); }

    function renderProducts(list){ const grid = $('#productsGrid'); grid.innerHTML = ''; if(!list.length){ $('#emptyState').style.display='block'; $('#productsCount').textContent = 0; return } else { $('#emptyState').style.display='none'; }
      $('#productsCount').textContent = list.length;
      list.forEach(p=>{
        const el = document.createElement('article'); el.className='card';
        el.innerHTML = `
          <div class="media"><img src="${p.image}" alt="${p.name}"></div>
          <div style="display:flex;flex-direction:column;gap:6px"><div class="title">${p.name}</div><div class="meta">${p.type} · کد: ${p.sku}</div></div>
          <div style="display:flex;align-items:center;justify-content:space-between;margin-top:8px"><div class="price">${formatPrice(p.price)} تومان</div><div class="meta">${p.stock>0? 'موجود' : 'ناموجود'}</div></div>
          <div class="prod-actions">
            <button class="btn btn-view" data-id="${p.id}">نمایش</button>
            <button class="btn btn-add" data-id="${p.id}" ${p.stock>0? '' : 'disabled'}>افزودن</button>
          </div>
        `;
        grid.appendChild(el);
      });

      // attach handlers after DOM built
      $$('.btn-view').forEach(b=>b.addEventListener('click', e=> openModal(e.currentTarget.dataset.id)));
      $$('.btn-add').forEach(b=>b.addEventListener('click', e=>{ addToCart(e.currentTarget.dataset.id,1); pulseCart(); }));
    }

    // ---------- Filters / Search / Sort ----------
    function populateTypeFilter(){ const types = Array.from(new Set(allProducts.map(p=>p.type))).sort(); const sel = $('#typeFilter'); types.forEach(t=>{ const o=document.createElement('option'); o.value=t; o.textContent=t; sel.appendChild(o); }) }

    function runFilters(){
      const q = $('#searchInput').value.trim().toLowerCase();
      const type = $('#typeFilter').value;
      const stock = $('#stockFilter').value;
      const min = Number($('#minPrice').value) || 0;
      const max = Number($('#maxPrice').value) || Number($('#priceRange').value) || Number($('#priceRange').max);

      filtered = allProducts.filter(p=>{
        if(type!=='all' && p.type!==type) return false;
        if(stock==='in' && p.stock<=0) return false;
        if(stock==='out' && p.stock>0) return false;
        if(p.price < min) return false;
        if(p.price > max) return false;
        if(q){ const hay = (p.name+' '+(p.description||'')+' '+p.sku).toLowerCase(); if(!hay.includes(q)) return false }
        return true;
      });

      // sort
      const sort = $('#sortSelect').value;
      if(sort==='price-asc') filtered.sort((a,b)=>a.price-b.price);
      else if(sort==='price-desc') filtered.sort((a,b)=>b.price-a.price);
      else if(sort==='name-asc') filtered.sort((a,b)=>a.name.localeCompare(b.name,'fa'));
      else if(sort==='name-desc') filtered.sort((a,b)=>b.name.localeCompare(a.name,'fa')).reverse();

      renderProducts(filtered);
    }

    // ---------- Modal ----------
    function openModal(id){ const p = allProducts.find(x=>String(x.id)===String(id)); if(!p) return; $('#modalTitle').textContent = 'جزئیات: ' + p.name; $('#modalImg').src = p.image; $('#modalName').textContent = p.name; $('#modalPrice').textContent = formatPrice(p.price) + ' تومان'; $('#modalDesc').textContent = p.description || '' ; $('#modalType').textContent = p.type + ' · کد: '+p.sku; $('#modalQty').value = 1; $('#modalMetaList').innerHTML = `<div class="meta">وضعیت موجودی: ${p.stock>0 ? 'موجود' : 'ناموجود'}</div><div class="meta">وزن: ${p.weight||'—'}</div>`; $('#modalBackdrop').style.display='flex'; $('#modalBackdrop').setAttribute('aria-hidden','false');
      // ensure modal focused for accessibility
      $('#modalBackdrop').focus();
      $('#modalAdd').onclick = ()=>{ const qty = Math.max(1, Number($('#modalQty').value)||1); addToCart(p.id, qty); pulseCart(); closeModal(); };
    }
    function closeModal(){ $('#modalBackdrop').style.display='none'; $('#modalBackdrop').setAttribute('aria-hidden','true'); }

    // ---------- UX niceties ----------
    function pulseCart(){ const el = $('#cartLink'); try{ el.animate([{transform:'scale(1)'},{transform:'scale(1.06)'},{transform:'scale(1)'}],{duration:340}); }catch(e){} }

    // ---------- Load products from shop.json ----------
    async function loadProducts(){
      try{
        const r = await fetch(PRODUCTS_JSON, {cache:'no-cache'});
        if(!r.ok) throw new Error('fetch failed');
        const data = await r.json(); allProducts = data.products || [];
      }catch(e){ console.warn('بارگیری shop.json شکست خورد — استفاده از نمونه محلی', e); allProducts = sampleProducts(); }

      // normalize ids and images path
      allProducts = allProducts.map((p,i)=>({ id: String(p.id||p.sku||i+1), image: p.image || 'prod-placeholder.jpg', ...p }));

      // set priceRange max
      const mx = Math.max(...allProducts.map(p=>p.price||0), 1000000);
      const pr = $('#priceRange'); pr.max = mx; pr.value = mx; $('#maxPrice').placeholder = mx.toLocaleString('fa-IR');

      populateTypeFilter(); runFilters(); updateCartCount();
    }

    // ---------- sample fallback ----------
    function sampleProducts(){ return [
      { id: 'P1001', name: 'میکسربرقی پارس خزر مدل A1', sku: 'P1001', type: 'میکسربرقی', price: 1850000, stock: 12, image: 'prod1.jpg', description: 'میکسربرقی قدرتمند با تیغه‌های استیل و ۲ سال گارانتی رسمی.' , weight: '1.2kg' },
      { id: 'P1002', name: 'چای‌ساز پارس خزر مدل T7', sku: 'P1002', type: 'چای‌ساز', price: 1290000, stock: 5, image: 'prod2.jpg', description: 'چای‌ساز جمع‌وجور با فیلتر قابل شستشو و سیستم قطع خودکار.' , weight: '1.1kg' }
    ]; }

    // ---------- Events wiring ----------
    document.addEventListener('DOMContentLoaded', ()=>{
      // inputs
      $('#searchInput').addEventListener('input', debounce(runFilters,200));
      $('#typeFilter').addEventListener('change', runFilters);
      $('#stockFilter').addEventListener('change', runFilters);
      $('#minPrice').addEventListener('input', runFilters);
      $('#maxPrice').addEventListener('input', runFilters);
      $('#priceRange').addEventListener('input', ()=>{ $('#maxPrice').value = $('#priceRange').value; runFilters(); });
      $('#sortSelect').addEventListener('change', runFilters);
      $('#resetFilters').addEventListener('click', ()=>{ $('#typeFilter').value='all'; $('#stockFilter').value='all'; $('#minPrice').value=''; $('#maxPrice').value=''; $('#priceRange').value = $('#priceRange').max; $('#searchInput').value=''; runFilters(); });
      $('#clearSearch').addEventListener('click', ()=>{ $('#searchInput').value=''; runFilters(); });

      // modal
      $('#modalClose').addEventListener('click', closeModal);
      $('#modalBackdrop').addEventListener('click', (e)=>{ if(e.target === $('#modalBackdrop')) closeModal(); });

      // theme
      const body = document.body; const themeBtn = $('#themeToggle'); const lbl = $('#themeLabel');
      const stored = localStorage.getItem('pk_theme'); if(stored==='dark'){ body.classList.add('dark'); lbl.textContent='دارک'; } else { body.classList.remove('dark'); lbl.textContent='سفید'; }
      themeBtn.addEventListener('click', ()=>{ if(body.classList.contains('dark')){ body.classList.remove('dark'); localStorage.setItem('pk_theme','light'); lbl.textContent='سفید'; } else { body.classList.add('dark'); localStorage.setItem('pk_theme','dark'); lbl.textContent='دارک'; } });

      // mobile filters toggle
      $('#showFilters').addEventListener('click', ()=>{ const pane = $('#filtersPane'); if(pane.style.display==='none' || pane.style.display==='') pane.style.display='block'; else pane.style.display='none'; });

      loadProducts();
    });

    // helpers
    function debounce(fn,ms=200){ let t; return (...a)=>{ clearTimeout(t); t=setTimeout(()=>fn(...a),ms); } }
    function $$(s){ return Array.from(document.querySelectorAll(s)); }
  </script>

  <!-- ------------------------------------------------------- -->
  <!-- sample shop.json (paste this as shop.json in same folder) -->
  <!-- ------------------------------------------------------- -->
  <!--
  {
    "products": [
      {
        "id": "P1001",
        "name": "میکسربرقی پارس خزر مدل A1",
        "sku": "P1001",
        "type": "میکسربرقی",
        "price": 1850000,
        "stock": 12,
        "image": "prod1.jpg",
        "description": "میکسربرقی قدرتمند با تیغه‌های استیل و ۲ سال گارانتی رسمی.",
        "weight": "1.2kg"
      },
      {
        "id": "P1002",
        "name": "چای‌ساز پارس خزر مدل T7",
        "sku": "P1002",
        "type": "چای‌ساز",
        "price": 1290000,
        "stock": 5,
        "image": "prod2.jpg",
        "description": "چای‌ساز جمع‌وجور با فیلتر قابل شستشو و سیستم قطع خودکار.",
        "weight": "1.1kg"
      }
    ]
  }
  -->

</body>
</html>
